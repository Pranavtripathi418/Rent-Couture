import { useState, useEffect } from 'react'
import Container from 'react-bootstrap/Container'
import Form from 'react-bootstrap/Form'
import Nav from 'react-bootstrap/Nav'
import Navbar from 'react-bootstrap/Navbar'
import GooglePlacesAutocomplete from 'react-google-places-autocomplete'
import toast from 'react-hot-toast'
import { useDispatch, useSelector } from 'react-redux'
import { Link, NavLink, useLocation, useNavigate } from 'react-router-dom'
import { filterAds, searchFilter } from '../redux/ads/adsSlice'
import { resetUser } from '../redux/auth/authSlice'

import profile from '../images/profile.png'

import Menu from '@mui/material/Menu'
import MenuItem from '@mui/material/MenuItem'
import { Avatar } from '@mui/material'

function Header() {
  const [value, setValue] = useState(null)
  const [input, setInput] = useState(null)
  const [anchorEl, setAnchorEl] = useState(null)
  const open = Boolean(anchorEl)

  const dispatch = useDispatch()
  const navigate = useNavigate()
  const location = useLocation()
  const { user } = useSelector((select) => select.auth)

  useEffect(() => {
    if (value || value !== null) {
      dispatch(filterAds(value.label))
    }
  }, [dispatch, value])

  useEffect(() => {
    dispatch(searchFilter(input))
  }, [dispatch, input])

  const logout = () => {
    localStorage.clear()
    dispatch(resetUser())
    navigate('/')
  }

  const handleSellBtnClick = () => {
    if (!user) {
      toast.error('To post Ad, Please login')
    }
  }

  const handleClick = (event) => {
    setAnchorEl(event.currentTarget)
  }
  const handleClose = () => {
    setAnchorEl(null)
  }

  return (
    <Navbar bg="light" expand="lg" style={{ height: '80px' }}>
      <Container>
        <NavLink to="/" className="navbar-brand">
        <svg width="40" height="40" viewBox="0 0 117 119" fill="none" xmlns="http://www.w3.org/2000/svg">
      <mask id="mask0_0_1" maskUnits="userSpaceOnUse" x="0" y="0" width="107" height="96">
      <path d="M107 0H0V96H107V0Z" fill="white"/>
      </mask>
      <g mask="url(#mask0_0_1)">
      <path d="M10.4735 42.0977C10.039 40.6429 10.0389 39.1111 10.4734 37.6564C10.9078 36.2016 11.7615 34.875 12.9485 33.8101L37.6841 11.6174C38.8711 10.5524 40.3496 9.78652 41.9711 9.39672C43.5926 9.00692 45.2998 9.00698 46.9213 9.39688L70.0676 14.9613C70.3085 12.1163 71.4125 9.38469 73.26 7.06226L45.3819 0.360981C43.3809 -0.120017 41.2741 -0.120007 39.2731 0.361012C37.2721 0.842033 35.4475 1.78712 33.9826 3.10128L3.45712 30.4886C1.99238 31.803 0.939007 33.4399 0.402874 35.2353C-0.133262 37.0305 -0.133274 38.9208 0.402838 40.7161L8.1593 66.6874C10.6949 64.9501 13.7137 63.8711 16.8863 63.5685L10.4735 42.0977Z" fill="#18CDCA"/>
      <path d="M89.9019 31.7139L96.5288 53.9024C96.9636 55.3575 96.963 56.889 96.5288 58.3436C96.0941 59.7986 95.2402 61.125 94.0532 62.19L69.3177 84.3832C68.1307 85.4481 66.6523 86.2137 65.0305 86.6037C63.4093 86.9933 61.7017 86.9933 60.0805 86.6037L36.1494 80.8503C35.8122 83.6968 34.6097 86.4053 32.6731 88.68L61.6204 95.6391C63.6212 96.1203 65.7282 96.1203 67.729 95.6391C69.7304 95.1579 71.5547 94.2132 73.0197 92.8988L103.545 65.5115C105.01 64.197 106.063 62.5602 106.599 60.7646C107.136 58.9695 107.136 57.0791 106.599 55.284L98.5505 28.3404C96.0685 30.1579 93.0758 31.3253 89.9019 31.7139Z" fill="#18CDCA"/>
      <path d="M8.85523 70.2692C6.89479 72.0279 5.55971 74.2693 5.01881 76.7086C4.47792 79.1484 4.75552 81.6772 5.8165 83.9754C6.87743 86.273 8.67414 88.2374 10.9793 89.6195C13.2845 91.0011 15.9947 91.7391 18.7672 91.7391C21.5396 91.7391 24.2498 91.0011 26.555 89.6195C28.8602 88.2374 30.6569 86.273 31.7178 83.9754C32.7788 81.6772 33.0564 79.1484 32.5155 76.7086C31.9746 74.2693 30.6395 72.0279 28.6791 70.2692C26.0482 67.9143 22.4836 66.5915 18.7672 66.5915C15.0508 66.5915 11.4861 67.9143 8.85523 70.2692Z" fill="#4F80E1"/>
      <path d="M77.5965 7.296C75.6364 9.05486 74.3008 11.2958 73.7604 13.7354C73.2194 16.175 73.4968 18.7038 74.5579 21.0019C75.6189 23.3 77.4154 25.2642 79.7203 26.6461C82.0259 28.0281 84.736 28.7657 87.5082 28.7657C90.2809 28.7657 92.991 28.0281 95.2965 26.6461C97.6015 25.2642 99.3979 23.3 100.459 21.0019C101.52 18.7038 101.797 16.175 101.257 13.7354C100.716 11.2958 99.3805 9.05486 97.4204 7.296C94.7898 4.94092 91.2247 3.61829 87.5082 3.61829C83.7922 3.61829 80.2271 4.94092 77.5965 7.296Z" fill="#4F80E1"/>
      <path d="M61.7289 81.3377C61.1659 81.3377 60.6058 81.2716 60.0619 81.1408L38.156 75.8743C37.4256 72.3747 35.5332 69.1548 32.7272 66.6374C29.9211 64.12 26.3324 62.4217 22.4318 61.7666L16.5624 42.1143C16.2714 41.134 16.2722 40.1024 16.5649 39.1226C16.8575 38.1427 17.4317 37.2489 18.23 36.5305L40.714 16.3574C41.5138 15.6398 42.51 15.1238 43.6026 14.8611C44.6952 14.5985 45.8456 14.5985 46.9381 14.8613L68.2299 19.9799C69.0744 23.4578 71.07 26.6258 73.9554 29.0689C76.8408 31.5119 80.4813 33.1162 84.3999 33.6715L90.4365 53.8889C90.7273 54.8695 90.7267 55.9011 90.4336 56.8807C90.141 57.8608 89.567 58.7545 88.7683 59.4731L66.2843 79.6457C65.6876 80.1837 64.9771 80.6107 64.1952 80.9008C63.4134 81.1914 62.5752 81.3398 61.7289 81.3377Z" fill="#4F80E1"/>
      </g>
      <path d="M8.06 104.04C9.48667 104.04 10.5667 104.367 11.3 105.02C12.0333 105.66 12.4 106.5 12.4 107.54C12.4 107.793 12.38 108.053 12.34 108.32C12.18 109.227 11.7667 110.053 11.1 110.8C10.4467 111.533 9.56667 112.047 8.46 112.34L10.8 118H7.54L5.46 112.56H4.12L3.16 118H0.34L2.82 104.04H8.06ZM9.46 108.38C9.48667 108.14 9.5 107.98 9.5 107.9C9.5 107.393 9.34 107 9.02 106.72C8.7 106.44 8.21333 106.3 7.56 106.3H5.22L4.48 110.48H6.82C7.56667 110.48 8.16 110.293 8.6 109.92C9.05333 109.547 9.34 109.033 9.46 108.38ZM19.9925 106.74C21.4058 106.74 22.5258 107.133 23.3525 107.92C24.1792 108.693 24.5925 109.74 24.5925 111.06C24.5925 111.487 24.5592 111.867 24.4925 112.2C24.4125 112.6 24.3258 112.947 24.2325 113.24H16.1325C16.1192 113.333 16.1125 113.467 16.1125 113.64C16.1125 114.333 16.3125 114.88 16.7125 115.28C17.1258 115.667 17.6658 115.86 18.3325 115.86C18.8925 115.86 19.3725 115.74 19.7725 115.5C20.1858 115.247 20.5192 114.92 20.7725 114.52H23.7925C23.2992 115.587 22.5325 116.467 21.4925 117.16C20.4658 117.84 19.2992 118.18 17.9925 118.18C16.5792 118.18 15.4458 117.78 14.5925 116.98C13.7392 116.18 13.3125 115.093 13.3125 113.72C13.3125 113.32 13.3525 112.9 13.4325 112.46C13.6325 111.313 14.0392 110.307 14.6525 109.44C15.2792 108.573 16.0525 107.907 16.9725 107.44C17.8925 106.973 18.8992 106.74 19.9925 106.74ZM21.7125 111.54C21.7392 111.327 21.7525 111.173 21.7525 111.08C21.7525 110.44 21.5458 109.94 21.1325 109.58C20.7192 109.22 20.1792 109.04 19.5125 109.04C18.8058 109.04 18.1725 109.267 17.6125 109.72C17.0525 110.16 16.6592 110.767 16.4325 111.54H21.7125ZM33.6163 106.76C34.7629 106.76 35.6629 107.073 36.3163 107.7C36.9829 108.313 37.3163 109.193 37.3163 110.34C37.3163 110.767 37.2829 111.153 37.2163 111.5L36.0563 118H33.2763L34.3563 111.88C34.3963 111.64 34.4163 111.407 34.4163 111.18C34.4163 110.513 34.2363 110.007 33.8763 109.66C33.5296 109.313 33.0296 109.14 32.3763 109.14C31.6296 109.14 30.9896 109.367 30.4563 109.82C29.9363 110.26 29.5896 110.9 29.4163 111.74L28.3163 118H25.4963L27.4563 106.92H30.2763L30.0363 108.28C30.4896 107.813 31.0296 107.447 31.6563 107.18C32.2829 106.9 32.9363 106.76 33.6163 106.76ZM42.5989 114.58C42.5856 114.66 42.5789 114.767 42.5789 114.9C42.5789 115.167 42.6522 115.36 42.7989 115.48C42.9589 115.587 43.2189 115.64 43.5789 115.64H44.8989L44.4789 118H42.6989C40.6989 118 39.6989 117.167 39.6989 115.5C39.6989 115.18 39.7256 114.867 39.7789 114.56L40.7189 109.22H39.3989L39.7989 106.92H41.1389L41.6189 104.18H44.4389L43.9589 106.92H46.4189L46.0189 109.22H43.5389L42.5989 114.58ZM47.0528 111C47.2928 109.627 47.8128 108.4 48.6128 107.32C49.4261 106.227 50.4195 105.38 51.5928 104.78C52.7795 104.167 54.0395 103.86 55.3728 103.86C56.9328 103.86 58.2328 104.26 59.2728 105.06C60.3128 105.86 60.9395 106.967 61.1528 108.38H57.9328C57.7195 107.74 57.3528 107.26 56.8328 106.94C56.3128 106.607 55.6728 106.44 54.9128 106.44C54.0995 106.44 53.3395 106.627 52.6328 107C51.9395 107.373 51.3528 107.907 50.8728 108.6C50.4061 109.293 50.0928 110.093 49.9328 111C49.8661 111.427 49.8328 111.78 49.8328 112.06C49.8328 113.14 50.1395 113.993 50.7528 114.62C51.3795 115.247 52.2261 115.56 53.2928 115.56C54.0528 115.56 54.7528 115.393 55.3928 115.06C56.0328 114.727 56.5728 114.24 57.0128 113.6H60.2328C59.5128 115.027 58.4928 116.14 57.1728 116.94C55.8661 117.727 54.4328 118.12 52.8728 118.12C51.6995 118.12 50.6595 117.887 49.7528 117.42C48.8595 116.94 48.1661 116.267 47.6728 115.4C47.1795 114.533 46.9328 113.54 46.9328 112.42C46.9328 111.953 46.9728 111.48 47.0528 111ZM66.7844 118.18C65.8377 118.18 64.9977 117.987 64.2644 117.6C63.5444 117.213 62.9844 116.667 62.5844 115.96C62.1844 115.253 61.9844 114.44 61.9844 113.52C61.9844 112.267 62.2777 111.127 62.8644 110.1C63.4644 109.06 64.2777 108.24 65.3044 107.64C66.3444 107.04 67.4977 106.74 68.7644 106.74C69.711 106.74 70.551 106.94 71.2844 107.34C72.031 107.727 72.6044 108.273 73.0044 108.98C73.4177 109.687 73.6244 110.5 73.6244 111.42C73.6244 112.687 73.3244 113.833 72.7244 114.86C72.1244 115.887 71.2977 116.7 70.2444 117.3C69.2044 117.887 68.051 118.18 66.7844 118.18ZM67.1644 115.78C67.831 115.78 68.4377 115.587 68.9844 115.2C69.531 114.813 69.9577 114.3 70.2644 113.66C70.571 113.02 70.7244 112.347 70.7244 111.64C70.7244 110.84 70.4977 110.227 70.0444 109.8C69.6044 109.36 69.0444 109.14 68.3644 109.14C67.6844 109.14 67.0777 109.333 66.5444 109.72C66.0244 110.107 65.6177 110.627 65.3244 111.28C65.031 111.92 64.8844 112.6 64.8844 113.32C64.8844 114.107 65.091 114.713 65.5044 115.14C65.931 115.567 66.4844 115.78 67.1644 115.78ZM86.9983 106.92L85.0383 118H82.2383L82.4783 116.6C82.0516 117.08 81.5249 117.46 80.8983 117.74C80.2716 118.007 79.6116 118.14 78.9183 118.14C77.7716 118.14 76.8649 117.833 76.1983 117.22C75.5316 116.593 75.1983 115.707 75.1983 114.56C75.1983 114.133 75.2316 113.753 75.2983 113.42L76.4383 106.92H79.2383L78.1583 113.02C78.1183 113.26 78.0983 113.493 78.0983 113.72C78.0983 114.373 78.2783 114.88 78.6383 115.24C78.9983 115.587 79.5049 115.76 80.1583 115.76C80.9183 115.76 81.5649 115.527 82.0983 115.06C82.6316 114.58 82.9716 113.9 83.1183 113.02L84.1983 106.92H86.9983ZM91.6809 114.58C91.6676 114.66 91.6609 114.767 91.6609 114.9C91.6609 115.167 91.7343 115.36 91.8809 115.48C92.0409 115.587 92.3009 115.64 92.6609 115.64H93.9809L93.5609 118H91.7809C89.7809 118 88.7809 117.167 88.7809 115.5C88.7809 115.18 88.8076 114.867 88.8609 114.56L89.8009 109.22H88.4809L88.8809 106.92H90.2209L90.7009 104.18H93.5209L93.0409 106.92H95.5009L95.1009 109.22H92.6209L91.6809 114.58ZM102.395 106.74C103.808 106.74 104.928 107.133 105.755 107.92C106.582 108.693 106.995 109.74 106.995 111.06C106.995 111.487 106.962 111.867 106.895 112.2C106.815 112.6 106.728 112.947 106.635 113.24H98.5348C98.5215 113.333 98.5148 113.467 98.5148 113.64C98.5148 114.333 98.7148 114.88 99.1148 115.28C99.5282 115.667 100.068 115.86 100.735 115.86C101.295 115.86 101.775 115.74 102.175 115.5C102.588 115.247 102.922 114.92 103.175 114.52H106.195C105.702 115.587 104.935 116.467 103.895 117.16C102.868 117.84 101.702 118.18 100.395 118.18C98.9815 118.18 97.8482 117.78 96.9948 116.98C96.1415 116.18 95.7148 115.093 95.7148 113.72C95.7148 113.32 95.7548 112.9 95.8348 112.46C96.0348 111.313 96.4415 110.307 97.0548 109.44C97.6815 108.573 98.4548 107.907 99.3748 107.44C100.295 106.973 101.302 106.74 102.395 106.74ZM104.115 111.54C104.142 111.327 104.155 111.173 104.155 111.08C104.155 110.44 103.948 109.94 103.535 109.58C103.122 109.22 102.582 109.04 101.915 109.04C101.208 109.04 100.575 109.267 100.015 109.72C99.4548 110.16 99.0615 110.767 98.8348 111.54H104.115ZM112.339 108.88C112.819 108.213 113.379 107.693 114.019 107.32C114.659 106.947 115.352 106.76 116.099 106.76L115.579 109.7H114.839C114.012 109.7 113.345 109.88 112.839 110.24C112.345 110.6 111.985 111.213 111.759 112.08L110.719 118H107.899L109.859 106.92H112.679L112.339 108.88Z" fill="#385EAA"/>
      </svg>
        </NavLink>
        <Navbar.Toggle aria-controls="navbarScroll" />
        <Navbar.Collapse id="navbarScroll">
          <Form className="d-flex" style={{ flex: 1 }}>
            <div style={{ width: '50%' }}>
              <GooglePlacesAutocomplete
                selectProps={{
                  value,
                  onChange: setValue,
                }}
                autocompletionRequest={{
                  componentRestrictions: { country: ['in'] },
                }}
              />
            </div>
            <Form.Control
              type="search"
              placeholder="Search"
              className="me-2 "
              aria-label="Search"
              value={input}
              onChange={(e) => setInput(e.target.value)}
            />
          </Form>
          <Nav
            className="ms-auto my-2 my-lg-0"
            style={{ maxHeight: '100px' }}
            navbarScroll
          >
            {!user && (
              <>
                <NavLink className="nav-link" to="/signin">
                  Login
                </NavLink>
                <NavLink className="nav-link" to="/signup">
                  Register
                </NavLink>
              </>
            )}

            {user && (
              <div style={{ marginLeft: '1rem' }}>
                <Avatar
                  alt="Remy Sharp"
                  src={user.picture ? user.picture : profile}
                  onClick={handleClick}
                  style={{ background: 'none', cursor: 'pointer' }}
                />

                <Menu
                  id="basic-menu"
                  anchorEl={anchorEl}
                  open={open}
                  onClose={handleClose}
                  MenuListProps={{
                    'aria-labelledby': 'basic-button',
                  }}
                  sx={{
                    '.MuiPaper-root': {
                      width: '20%',
                      padding: '1rem',
                      left: 'auto !important',
                      right: '150px',
                    },
                  }}
                >
                  <div className="d-flex">
                    <img
                      src={user.picture ? user.picture : profile}
                      width={50}
                      height={50}
                      alt="profile"
                      style={{ borderRadius: '50%' }}
                    />

                    <div className="d-flex flex-column ps-2">
                      <span>Hello</span>
                      <span style={{ fontWeight: 'bold' }}>
                        {user.fullname}
                      </span>
                      <Link to="/" style={{ color: 'black' }}>
                        view and edit profile
                      </Link>
                    </div>
                  </div>
                  <hr />
                  <Link
                    to="/myads"
                    className="MuiButtonBase-root MuiMenuItem-root MuiMenuItem-gutters css-kk1bwy-MuiButtonBase-root-MuiMenuItem-root"
                    style={{
                      color: '#333',
                      padding: '6px 16px',
                      textDecoration: 'none',
                    }}
                  >
                    My Ads
                  </Link>
                  <MenuItem to="/" onClick={logout}>
                    Logout
                  </MenuItem>
                </Menu>
              </div>
            )}

            <NavLink
              className="nav-link ms-2 fw-bold btn-warning rounded"
              to="/post"
              onClick={handleSellBtnClick}
            >
              Post your ad here
            </NavLink>
          </Nav>
        </Navbar.Collapse>
      </Container>
    </Navbar>
  )
}

export default Header
